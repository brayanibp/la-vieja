<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>La vieja</title>
	<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body id="myBody">
	<table id="table">
		<tr>
			<td id="1"></td>
			<td id="2"></td>
			<td id="3"></td>
		</tr>
		<tr>
			<td id="4"></td>
			<td id="5"></td>
			<td id="6"></td>
		</tr>
		<tr>
			<td id="7"></td>
			<td id="8"></td>
			<td id="9"></td>
		</tr>
	</table>
	<script type="text/javascript">
		const moves = 9;
		var uPositions = [];
		const table = document.getElementById('table');
		table.addEventListener('click',detect)

		function detect(ev) {
			
			if (ev.target.id !="") {
				let actualTarget = ev.target
				if (actualTarget.className != 'full') {
					newDiv = document.createElement('div')
					newDiv.classList.add('img-c')
					actualTarget.appendChild(newDiv)	
					actualTarget.className = "full"
					uPositions.push(actualTarget.id)
					tableEvaluation(uPositions)
				} else {
					message('mark')
				}
			} else {
				message('mark')
			}
			
		}

		function tableEvaluation(uMoves) {
			if (uMoves.length < 9) {
				console.log(uMoves)
				let conca = ''
				orderM = uMoves.sort()
				orderM.map((nmove)=>{
					conca += nmove
				})
				
				switch (conca != "") {
					case conca.indexOf('123') != -1:
						message('win',['Oky doki'],()=>{
						setTimeout(()=>{
							const xMessageBox = document.getElementById('message')
							const fullblocks = document.getElementByClassName('')
							doc.removeChild(xMessageBox)
							
						},0)
					})
						break;
					case conca.indexOf('456') != -1:
						message('win')
						break;
					case conca.indexOf('789') != -1:
						message('win')
						break;
					case conca.indexOf('159') != -1:
						message('win')
						break;
					case conca.indexOf('357') != -1:
						message('win')
						break;
				}
				//conca==123 ? message('win') : console.log(conca);
			} else {
				message('equal')

			}
		}

		function message(m,buttons = false,fun = false) {
			setTimeout(()=>{
					switch (m !='') {

					case m == 'win':
						box('Â¡Enhorabuena Ganaste!',buttons,fun)
						break;
					case m == 'loss':
						box('Haz Perdido :(',buttons,fun)
						break;
					case m == 'equal':
						box('Fue un Empate',buttons,fun)
						break;
					case m == 'mark':
						box('Esa posicion ya fue marcada',buttons,fun)
						break;
				}
			},100)
		}

		function box(m,buttons = false,bFuncts = false) {
			const messageBox = document.createElement('div')
			messageBox.classList.add('message')
			messageBox.id = 'message'
			const text = document.createElement('p')
			text.innerHTML = m
			messageBox.appendChild(text)
			if (buttons) {
				let uButtonOk = document.createElement('button')
				uButtonOk.classList.add('button')
				uButtonOk.innerHTML = buttons[0]
				messageBox.appendChild(uButtonOk)
				if (bFuncts) {
					uButtonOk.addEventListener('click',bFuncts)
				} else {
					uButtonOk.addEventListener('click',()=>{doc.removeChild(messageBox)})
				}
				
			} else {
				let dButton = document.createElement('button')
				dButton.classList.add('button')
				dButton.innerHTML = 'Ok'
				dButton.addEventListener('click',()=>{
					setTimeout(()=>{
						doc.removeChild(messageBox)
					},0)
				})
				messageBox.appendChild(dButton)
			}
			doc = document.getElementById('myBody')
			doc.appendChild(messageBox)
		}

	</script>
</body>
</html>